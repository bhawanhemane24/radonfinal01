const newPublisherModel=require("../models/newPublisherModel")
const newAuthorModel = require("../models/newAuthorModel")
const newBookModel =require("../models/newBookModel")
const authorModel = require("../models/authorModel")
const createBook= async function(req,res){
    let book=req.body
    let authorId= await newAuthorModel.find({_id:req.body.author_id}).select({_id:1})
    let publisherId=await newPublisherModel.find({_id:req.body.publisher_id}).select({id:1})
    if(authorId)
    {
        if(publisherId)
        {

    let createbook=await newBookModel.create(book)
    res.send({data:createbook})
        }
        else{
            res.send("publisher is not present")
        }
    }
    else{
        res.send("author id is absent")
    }
}
const getBooksData=async function(req,res)
{
    let author_idd= await newAuthorModel.find({_id:req.body.author_id}).select({_id:1})
    let publisher_id=await newPublisherModel.find({_id:req.body.publisher_id}).select({id:1})
    if(author_id!=ObjectId){

    if(publisher_id!=ObjectId)
    {
    const book=await newBookModel.find()
    res.send({data:book})
    }
    else{
         res.send("publisher is not vaild")
    }
}
    else{
        res.send("author id not valid")
    }
}
const getdetaildata=async function(req,res){
    const detaildata= await newBookModel.find().populate('author_id')
    const detaildata1=await newBookModel.find().populate('publisher_id')
    res.send({detaildata,detaildata1})
}
const updatedata= async function(req,res){
    const updatedata=await newBookModel.find(updateOne({name:HarperCollins}{$set:{isHardCover:"true"}}))
    const updatedata1=await newBookModel.find(updateOne({name:Penguin}{$set:{isHardCover:"true"}}))
     res.send({updatedata,updatedata1})
}
const updateprice= async function(req,res){
    const updateprice=await newAuthorModel.find({rating:{$gte:3.5}}.updatemany({price:price+10}))
    res.send(updateprice)
}
    


module.exports.createBook=createBook
module.exports.getBooksData=getBooksData
module.exports.getdetaildata=getdetaildata